/**
 * ═══════════════════════════════════════════════════════════════
 * OPUS FLEET - MARKETING CAMPAIGN GENERATOR
 * Social Enterprise Launch Assets via T5500 (Zero Cost)
 * ═══════════════════════════════════════════════════════════════
 *
 * Purpose: Generate launch campaign content using T5500 local inference
 * Cost: $0.00 (vs ~$0.15 on cloud APIs)
 * Campaign: Social Enterprise Model - 60% to Pediatric Charity
 *
 * Prompts provided by: Gemini Strategy Advisor
 * Generated by: T5500 Llama 3.2 (GTX 1050 Ti GPU Acceleration)
 *
 * FOR THE KIDS. ALWAYS.
 * ═══════════════════════════════════════════════════════════════
 */

const fs = require('fs');
const path = require('path');

// Set higher timeout for creative content generation (90s for complex prompts)
process.env.FLEET_TIMEOUT = '90000';

const { askFleet } = require('../scripts/hive/agents/free-brain.cjs');

// Configuration
const OUTPUT_FILE = path.join(__dirname, 'CAMPAIGN-LAUNCH-ASSETS.md');
const LOG_FILE = path.join(__dirname, '../logs/campaign-generator.log');

// Ensure logs directory exists
const logsDir = path.dirname(LOG_FILE);
if (!fs.existsSync(logsDir)) {
    fs.mkdirSync(logsDir, { recursive: true });
}

/**
 * Gemini Strategy Advisor Prompts (EXACT strings)
 */
const PROMPTS = {
    story: "Write a short, engaging Instagram caption explaining how buying AI solutions from AI Solutions Store directly supports pediatric charities, highlighting the tech-for-good aspect without sounding like a donation plea. Focus on the impact of the technology and the charitable giving.",

    hooks: "Generate 10 attention-grabbing headlines for AI Solutions Store products (like Claude Droid or Income Droid) that mention the 60% charitable giving split as a value-add. Focus on creating 'Stop Scroll' headlines that highlight the benefits of the products and the charitable impact.",

    transparency: "Explain in simple terms how the Smart Contract routing works, building trust that the money actually goes to the kids. Focus on transparency and the security of the blockchain."
};

/**
 * Logger function
 */
function log(message) {
    const timestamp = new Date().toISOString();
    const logLine = `[${timestamp}] [CAMPAIGN-GEN] ${message}`;
    console.log(logLine);
    try {
        fs.appendFileSync(LOG_FILE, logLine + '\n');
    } catch (err) {
        // Ignore log errors
    }
}

/**
 * Generate campaign assets
 */
async function generateCampaign() {
    console.log(`
╔═══════════════════════════════════════════════════════════════╗
║                                                               ║
║         OPUS FLEET - CAMPAIGN ASSET GENERATOR                 ║
║         Social Enterprise Launch Content                      ║
║                                                               ║
║         Platform: T5500 Llama 3.2 (Zero Cost)                 ║
║         Strategy: Gemini Advisor Prompts                      ║
║         Campaign: 60% to Pediatric Charity                    ║
║                                                               ║
╚═══════════════════════════════════════════════════════════════╝
`);

    const startTime = Date.now();
    const results = {};

    try {
        // Generate Story
        console.log('\n' + '='.repeat(60));
        console.log('Generating Story...');
        console.log('='.repeat(60) + '\n');
        log('Starting: Story generation');

        const storyStart = Date.now();
        results.story = await askFleet(PROMPTS.story, {
            temperature: 0.8,
            maxTokens: 300
        });
        const storyTime = Date.now() - storyStart;
        log(`SUCCESS: Story generated in ${(storyTime / 1000).toFixed(1)}s`);
        console.log(`✅ Story generated in ${(storyTime / 1000).toFixed(1)}s\n`);

        // Generate Hooks
        console.log('='.repeat(60));
        console.log('Generating Hooks...');
        console.log('='.repeat(60) + '\n');
        log('Starting: Hooks generation');

        const hooksStart = Date.now();
        results.hooks = await askFleet(PROMPTS.hooks, {
            temperature: 0.8,
            maxTokens: 400
        });
        const hooksTime = Date.now() - hooksStart;
        log(`SUCCESS: Hooks generated in ${(hooksTime / 1000).toFixed(1)}s`);
        console.log(`✅ Hooks generated in ${(hooksTime / 1000).toFixed(1)}s\n`);

        // Generate Transparency
        console.log('='.repeat(60));
        console.log('Generating Transparency...');
        console.log('='.repeat(60) + '\n');
        log('Starting: Transparency generation');

        const transStart = Date.now();
        results.transparency = await askFleet(PROMPTS.transparency, {
            temperature: 0.7,
            maxTokens: 300
        });
        const transTime = Date.now() - transStart;
        log(`SUCCESS: Transparency generated in ${(transTime / 1000).toFixed(1)}s`);
        console.log(`✅ Transparency generated in ${(transTime / 1000).toFixed(1)}s\n`);

        const totalTime = Date.now() - startTime;

        // Build and save markdown
        const markdown = buildMarkdown(results, {
            storyTime,
            hooksTime,
            transTime,
            totalTime
        });

        fs.writeFileSync(OUTPUT_FILE, markdown);
        log(`Campaign assets saved to: ${OUTPUT_FILE}`);
        console.log(`✅ Campaign assets saved to: ${path.relative(process.cwd(), OUTPUT_FILE)}\n`);

        // Print summary
        console.log(`
╔═══════════════════════════════════════════════════════════════╗
║                    GENERATION COMPLETE                        ║
╚═══════════════════════════════════════════════════════════════╝

  Sections Generated: 3/3
  Total Time:         ${(totalTime / 1000).toFixed(1)}s
  Cost:               $0.00 (vs ~$0.15 on cloud)
  Saved:              100% cost reduction

  Output File: ${path.relative(process.cwd(), OUTPUT_FILE)}

FOR THE KIDS. ALWAYS.
`);

        return results;

    } catch (error) {
        log(`FATAL ERROR: ${error.message}`);
        console.error(`\n❌ Campaign generation failed: ${error.message}\n`);
        throw error;
    }
}

/**
 * Build markdown output
 */
function buildMarkdown(results, stats) {
    const timestamp = new Date().toISOString();

    return `# AI Solutions Store - Social Enterprise Launch Campaign

**Generated**: ${timestamp}
**Platform**: T5500 Llama 3.2 (GTX 1050 Ti GPU Acceleration)
**Cost**: $0.00 (Zero OPEX local inference)
**Campaign**: Social Enterprise Model - 60% to Pediatric Charity

---

## Generation Stats

- **Sections**: 3/3 successful
- **Story**: ${(stats.storyTime / 1000).toFixed(1)}s
- **Hooks**: ${(stats.hooksTime / 1000).toFixed(1)}s
- **Transparency**: ${(stats.transTime / 1000).toFixed(1)}s
- **Total Time**: ${(stats.totalTime / 1000).toFixed(1)}s
- **Cloud API Cost (if used)**: ~$0.15
- **Actual Cost**: $0.00
- **Savings**: 100%

---

## 1. Instagram Story Caption

${results.story}

---

## 2. Product Headlines ("Stop Scroll" Hooks)

${results.hooks}

---

## 3. Smart Contract Transparency Explainer

${results.transparency}

---

## Usage Guide

### Instagram Story
1. Copy the caption from Section 1
2. Pair with product screenshot or team photo
3. Add QR code linking to ai-solutions.store
4. Use story stickers: Poll, Quiz, or Link

### Headlines (Section 2)
Use these for:
- Instagram post captions
- Twitter/X posts
- Facebook ads
- Email subject lines
- Landing page hero text
- Pinterest pin descriptions

### Transparency (Section 3)
Use this for:
- Website "About" page
- FAQ section "How does the charity work?"
- Customer support responses
- Social media DM replies
- Email newsletter explanation block

---

## Deployment Checklist

- [ ] Review content for brand voice alignment
- [ ] Create visual assets (product images, infographics)
- [ ] Schedule Instagram story post
- [ ] Tweet 3-5 headlines with product links
- [ ] Update website About page with transparency text
- [ ] A/B test different headlines
- [ ] Monitor engagement (likes, shares, clicks)
- [ ] Track conversions to ai-solutions.store

---

## Performance Tracking

Track these metrics:
- Instagram story views and exits
- Click-through rate on QR code/link
- Website traffic from social media
- Conversion rate to product purchases
- Customer questions about charity model

Adjust messaging based on:
- Which headlines get most engagement
- Customer feedback and questions
- Conversion data (which messaging drives sales)

---

**FOR THE KIDS. ALWAYS.**

*Generated via OPUS FLEET - Zero OPEX Marketing Automation*
*Prompts by: Gemini Strategy Advisor*
*Inference by: T5500 Llama 3.2*
`;
}

// Execute if run directly
if (require.main === module) {
    generateCampaign()
        .then(() => {
            process.exit(0);
        })
        .catch((error) => {
            console.error('\n❌ Campaign generation failed:', error.message);
            log(`FATAL ERROR: ${error.message}`);
            process.exit(1);
        });
}

// Export for use in other scripts
module.exports = {
    generateCampaign,
    PROMPTS
};
